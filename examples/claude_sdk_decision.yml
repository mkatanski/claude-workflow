# Claude SDK Decision Routing
# Demonstrates: output_type: decision for dynamic workflow branching
# Use case: AI-driven workflow routing without manual conditions

type: claude-workflow
version: 2

name: "Claude SDK Decision Routing"

claude:
  interactive: true
  dangerously_skip_permissions: true

claude_sdk:
  model: sonnet

tmux:
  split: vertical
  idle_time: 3.0

steps:
  # Gather context
  - name: "Get issue description"
    tool: set
    var: issue_description
    value: "Users are reporting slow page load times on the dashboard. The issue started after the last deployment."

  # Let AI decide the workflow path
  - name: "Route issue to handler"
    tool: claude_sdk
    prompt: |
      Analyze this issue and decide which team should handle it:

      Issue: {issue_description}

      Choose the most appropriate handler based on the issue type.
      Available handlers:
      - "handle_performance" for performance/speed issues
      - "handle_bug" for functional bugs
      - "handle_feature" for feature requests
      - "handle_docs" for documentation issues
    output_type: decision
    output_var: routing_decision

  # Performance handling branch
  - name: "handle_performance"
    tool: bash
    command: "echo 'Performance team handling: Running profiler...'"
    output_var: perf_result

  - name: "Performance analysis"
    tool: bash
    command: "echo 'Checking response times and resource usage'"
    output_var: perf_analysis

  - name: "Performance done"
    tool: goto
    target: "Complete handling"

  # Bug handling branch
  - name: "handle_bug"
    tool: bash
    command: "echo 'Bug team handling: Checking error logs...'"
    output_var: bug_result

  - name: "Bug investigation"
    tool: bash
    command: "echo 'Investigating root cause'"
    output_var: bug_analysis

  - name: "Bug done"
    tool: goto
    target: "Complete handling"

  # Feature handling branch
  - name: "handle_feature"
    tool: bash
    command: "echo 'Feature team handling: Adding to backlog...'"
    output_var: feature_result

  - name: "Feature done"
    tool: goto
    target: "Complete handling"

  # Docs handling branch
  - name: "handle_docs"
    tool: bash
    command: "echo 'Docs team handling: Updating documentation...'"
    output_var: docs_result

  # Common completion
  - name: "Complete handling"
    tool: bash
    command: "echo 'Issue routing complete. Decision: {routing_decision}'"
    output_var: completion_status
