# Context Tool Example
# Demonstrates batch variable operations: set multiple, copy, clear, export
# The context tool is for managing multiple variables at once

type: claude-workflow
version: 2
name: "Context Tool Demo"
description: "Showcase all context tool actions: set, copy, clear, export"

steps:
  # ============================================================
  # ACTION: set - Set multiple variables at once
  # ============================================================
  - name: "Initialize configuration"
    tool: context
    action: set
    values:
      api_url: "https://api.example.com"
      timeout: "30"
      max_retries: "3"
      environment: "development"

  - name: "Show initialized values"
    tool: bash
    command: "echo 'API: {api_url}, Timeout: {timeout}s, Env: {environment}'"

  # ============================================================
  # ACTION: set - Set variables with interpolation
  # ============================================================
  - name: "Build derived values"
    tool: context
    action: set
    values:
      full_api_url: "{api_url}/v2"
      config_summary: "env={environment}, retries={max_retries}"

  - name: "Show derived values"
    tool: bash
    command: "echo 'Full URL: {full_api_url}'"

  # ============================================================
  # ACTION: copy - Copy variables to new names
  # ============================================================
  - name: "Backup current configuration"
    tool: context
    action: copy
    mappings:
      api_url: backup_api_url
      environment: backup_environment
      timeout: backup_timeout

  - name: "Show backup was created"
    tool: bash
    command: "echo 'Backup API URL: {backup_api_url}'"

  # ============================================================
  # Modify original values (to show copy independence)
  # ============================================================
  - name: "Change environment to production"
    tool: context
    action: set
    values:
      environment: "production"
      api_url: "https://prod.api.example.com"

  - name: "Compare original vs backup"
    tool: bash
    command: |
      echo "Current: env={environment}, api={api_url}"
      echo "Backup:  env={backup_environment}, api={backup_api_url}"

  # ============================================================
  # ACTION: export - Export context to JSON file (for debugging)
  # ============================================================
  - name: "Export all variables to file"
    tool: context
    action: export
    file: "/tmp/workflow-context-all.json"

  - name: "Show exported file"
    tool: bash
    command: "cat /tmp/workflow-context-all.json | head -20"

  # ============================================================
  # ACTION: export - Export specific variables only
  # ============================================================
  - name: "Export only production config"
    tool: context
    action: export
    file: "/tmp/workflow-context-prod.json"
    vars:
      - environment
      - api_url
      - timeout

  - name: "Show selective export"
    tool: bash
    command: "cat /tmp/workflow-context-prod.json"

  # ============================================================
  # ACTION: clear - Remove specific variables
  # ============================================================
  - name: "Clear temporary variables"
    tool: context
    action: clear
    vars:
      - config_summary
      - full_api_url

  - name: "Verify variables cleared"
    tool: bash
    command: "echo 'config_summary is now: {config_summary}'"
    on_error: continue

  # ============================================================
  # Restore from backup using copy
  # ============================================================
  - name: "Restore from backup"
    tool: context
    action: copy
    mappings:
      backup_api_url: api_url
      backup_environment: environment

  - name: "Show restored values"
    tool: bash
    command: "echo 'Restored: env={environment}, api={api_url}'"

  # ============================================================
  # Clean up backup variables
  # ============================================================
  - name: "Clean up backups"
    tool: context
    action: clear
    vars:
      - backup_api_url
      - backup_environment
      - backup_timeout

  - name: "Final state"
    tool: bash
    command: "echo 'Final environment: {environment}'"
