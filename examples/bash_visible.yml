# Bash Visible Mode
# Demonstrates: visible: true for real-time command monitoring in tmux
# Use case: Long-running commands where you want to see output in real-time

type: claude-workflow
version: 2

name: "Bash Visible Mode"

claude:
  interactive: true
  dangerously_skip_permissions: true

tmux:
  split: vertical
  idle_time: 5.0

steps:
  # ===========================================
  # Compare visible vs background modes
  # ===========================================

  - name: "Background mode (default)"
    tool: bash
    command: "echo 'This runs in background (not visible in tmux pane)'"
    output_var: bg_output

  - name: "Report background output"
    tool: bash
    command: "echo 'Background output: {bg_output}'"

  # Visible mode - runs in tmux pane
  - name: "Visible mode command"
    tool: bash
    command: "echo 'Step 1'; sleep 1; echo 'Step 2'; sleep 1; echo 'Step 3'; echo 'Done!'"
    visible: true
    output_var: visible_output

  - name: "Report visible output"
    tool: bash
    command: "echo 'Visible mode captured output (may differ from what was shown in pane)'"

  # ===========================================
  # Practical example: Build process
  # ===========================================

  - name: "Simulate build process"
    tool: bash
    command: |
      echo "Starting build process..."
      echo "[1/4] Compiling sources..."
      sleep 1
      echo "[2/4] Running linter..."
      sleep 1
      echo "[3/4] Running tests..."
      sleep 1
      echo "[4/4] Packaging..."
      sleep 1
      echo "Build complete!"
    visible: true
    output_var: build_output

  - name: "Build result"
    tool: bash
    command: "echo 'Build process finished'"

  # ===========================================
  # Working directory with visible mode
  # ===========================================

  - name: "Get current directory"
    tool: bash
    command: "pwd"
    output_var: current_dir

  - name: "Visible with custom cwd"
    tool: bash
    command: "echo 'Working in directory:' && pwd && echo 'Files:' && ls -la | head -5"
    visible: true
    cwd: "/tmp"
    output_var: tmp_listing

  - name: "Report cwd result"
    tool: bash
    command: "echo 'Listed files in /tmp'"

  # ===========================================
  # Preserve whitespace with strip_output: false
  # ===========================================

  - name: "Generate formatted output"
    tool: bash
    command: |
      echo "Column1    Column2    Column3"
      echo "-------    -------    -------"
      echo "Value1     Value2     Value3"
      echo "A          B          C"
    strip_output: false
    output_var: formatted_table

  - name: "Show preserved formatting"
    tool: bash
    command: "echo 'Formatted table preserved whitespace'"

  # With stripping (default)
  - name: "Generate with stripping"
    tool: bash
    command: "   echo 'has leading spaces'   "
    strip_output: true
    output_var: stripped_output

  - name: "Show stripped result"
    tool: bash
    command: "echo 'Stripped: [{stripped_output}]'"

  # ===========================================
  # Visible mode for interactive feedback
  # ===========================================

  - name: "Progress indicator"
    tool: bash
    command: |
      for i in 1 2 3 4 5; do
        echo "Processing item $i of 5..."
        sleep 0.5
      done
      echo "All items processed!"
    visible: true
    output_var: progress_output

  - name: "Workflow complete"
    tool: bash
    command: "echo 'Visible mode demonstration complete'"
    output_var: done
